{
  "security": {
    "loadMethods": {
      "sql": "SELECT\n  pmp.profile_id AS \"profileId\",\n  INITCAP(m.resource) AS \"objectName\",\n  m.action AS \"methodName\"\nFROM public.profile_method_permissions pmp\nJOIN public.methods m ON m.id = pmp.method_id\nWHERE pmp.allowed = TRUE"
    }
  },
  "public": {
    "getUserByUsername": {
      "sql": "SELECT id, username, password_hash AS \"passwordHash\", profile_id AS \"profileId\"\nFROM public.users\nWHERE username = $1"
    },
    "createUser": {
      "sql": "INSERT INTO public.users (username, password_hash, profile_id)\nVALUES ($1, $2, $3)\nRETURNING id"
    },
    "getUserById": {
      "sql": "SELECT u.id, u.username, u.profile_id AS \"profileId\", p.name AS \"profileName\", p.profile_key AS \"profileKey\" FROM public.users u LEFT JOIN public.profiles p ON u.profile_id = p.id WHERE u.id = $1"
    }
  },
  "Events": {
    "list": {
      "sql": "SELECT * FROM events ORDER BY date ASC"
    },
    "get": {
      "sql": "SELECT * FROM events WHERE id = $1"
    },
    "create": {
      "sql": "INSERT INTO events (title, description, date, location_id, capacity, created_by, ticket_price) VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING *"
    },
    "update": {
      "sql": "UPDATE events SET title=$2, description=$3, date=$4, location_id=$5, capacity=$6, ticket_price=$7 WHERE id=$1 RETURNING *"
    },
    "delete": {
      "sql": "DELETE FROM events WHERE id=$1"
    }
  },
  "Registrations": {
    "register": {
      "sql": "INSERT INTO registrations (event_id, user_id, guest_name, guest_email, payment_status, amount_paid) VALUES ($1, $2, $3, $4, 'PENDING', 0) RETURNING *"
    },
    "listAttendees": {
      "sql": "SELECT * FROM registrations WHERE event_id = $1"
    },
    "checkIn": {
      "sql": "UPDATE registrations SET status='CHECKED_IN' WHERE id=$1 RETURNING *"
    },
    "collectPayment": {
      "sql": "UPDATE registrations SET payment_status='PAID', amount_paid=$2 WHERE id=$1 RETURNING *"
    },
    "recordIncome": {
      "sql": "INSERT INTO incomes (event_id, description, amount, source) VALUES ($1, $2, $3, 'TICKET_SALE') RETURNING *"
    },
    "cancel": {
      "sql": "UPDATE registrations SET status='CANCELLED' WHERE id=$1 RETURNING *"
    }
  },
  "Reservations": {
    "list": {
      "sql": "SELECT r.*, l.name as location_name, e.title as event_title FROM reservations r JOIN locations l ON r.location_id = l.id LEFT JOIN events e ON r.event_id = e.id ORDER BY r.date ASC"
    },
    "create": {
      "sql": "INSERT INTO reservations (location_id, event_id, date) VALUES ($1, $2, $3) RETURNING *"
    },
    "cancel": {
      "sql": "UPDATE reservations SET status='CANCELLED' WHERE id=$1 RETURNING *"
    },
    "getLocations": {
      "sql": "SELECT * FROM locations ORDER BY name"
    }
  },
  "Roles": {
    "list": {
      "sql": "SELECT * FROM roles ORDER BY name"
    },
    "get": {
      "sql": "SELECT * FROM roles WHERE id = $1"
    },
    "create": {
      "sql": "INSERT INTO roles (name, base_cost) VALUES ($1, $2) RETURNING *"
    },
    "update": {
      "sql": "UPDATE roles SET name = $2, base_cost = $3 WHERE id = $1 RETURNING *"
    },
    "delete": {
      "sql": "DELETE FROM roles WHERE id = $1"
    }
  },
  "Staffing": {
    "listByEvent": {
      "sql": "SELECT s.*, r.name as role_name FROM staffing s JOIN roles r ON s.role_id = r.id WHERE s.event_id = $1 ORDER BY s.person_name"
    },
    "assign": {
      "sql": "INSERT INTO staffing (event_id, person_name, role_id, agreed_cost) VALUES ($1, $2, $3, $4) RETURNING *"
    },
    "remove": {
      "sql": "DELETE FROM staffing WHERE id = $1"
    }
  },
  "Payments": {
    "listByEvent": {
      "sql": "SELECT s.id as staffing_id, s.person_name, r.name as role_name, s.agreed_cost, p.id as payment_id, p.amount, p.status, p.payment_date FROM staffing s JOIN roles r ON s.role_id = r.id LEFT JOIN payments p ON s.id = p.staffing_id WHERE s.event_id = $1 ORDER BY s.person_name"
    },
    "create": {
      "sql": "INSERT INTO payments (staffing_id, amount, status) VALUES ($1, $2, 'PENDING') RETURNING *"
    },
    "pay": {
      "sql": "UPDATE payments SET status = 'PAID', payment_date = NOW() WHERE id = $1 RETURNING *"
    }
  },
  "Expenses": {
    "list": {
      "sql": "SELECT * FROM expenses ORDER BY expense_date DESC"
    },
    "listByEvent": {
      "sql": "SELECT * FROM expenses WHERE event_id = $1 ORDER BY expense_date DESC"
    },
    "get": {
      "sql": "SELECT * FROM expenses WHERE id = $1"
    },
    "create": {
      "sql": "INSERT INTO expenses (event_id, description, amount, category) VALUES ($1, $2, $3, $4) RETURNING *"
    },
    "update": {
      "sql": "UPDATE expenses SET event_id = $2, description = $3, amount = $4, category = $5 WHERE id = $1 RETURNING *"
    },
    "delete": {
      "sql": "DELETE FROM expenses WHERE id = $1"
    }
  },
  "Attendance": {
    "listByEvent": {
      "sql": "SELECT * FROM registrations WHERE event_id = $1 ORDER BY guest_name"
    },
    "markAttendance": {
      "sql": "UPDATE registrations SET status='CHECKED_IN' WHERE id=$1 RETURNING *"
    }
  },
  "Reports": {
    "eventSummary": {
      "sql": "SELECT e.title, e.status, COUNT(DISTINCT r.id) as attendees, COUNT(DISTINCT s.id) as staff_count, COALESCE(SUM(p.amount), 0) as total_payments FROM events e LEFT JOIN registrations r ON e.id = r.event_id LEFT JOIN staffing s ON e.id = s.event_id LEFT JOIN payments p ON s.id = p.staffing_id AND p.status = 'PAID' WHERE e.id = $1 GROUP BY e.id"
    },
    "financialReport": {
      "sql": "SELECT e.title, COALESCE(SUM(s.agreed_cost), 0) as projected_cost, COALESCE(SUM(p.amount), 0) as paid_amount FROM events e LEFT JOIN staffing s ON e.id = s.event_id LEFT JOIN payments p ON s.id = p.staffing_id AND p.status = 'PAID' GROUP BY e.id, e.title"
    },
    "eventFinancialDetail": {
      "sql": "SELECT e.title, e.status, (SELECT COALESCE(SUM(amount), 0) FROM incomes WHERE event_id = e.id) as total_income, (SELECT COALESCE(SUM(amount), 0) FROM expenses WHERE event_id = e.id) as total_expenses, (SELECT COALESCE(SUM(agreed_cost), 0) FROM staffing WHERE event_id = e.id) as staff_cost, (SELECT COALESCE(SUM(p.amount), 0) FROM payments p JOIN staffing s ON p.staffing_id = s.id WHERE s.event_id = e.id AND p.status = 'PAID') as staff_paid, ((SELECT COALESCE(SUM(amount), 0) FROM incomes WHERE event_id = e.id) - (SELECT COALESCE(SUM(amount), 0) FROM expenses WHERE event_id = e.id) - (SELECT COALESCE(SUM(agreed_cost), 0) FROM staffing WHERE event_id = e.id)) as balance FROM events e WHERE e.id = $1"
    },
    "eventAttendanceDetail": {
      "sql": "SELECT e.title, COUNT(r.id) as total_registered, COUNT(CASE WHEN r.status = 'CHECKED_IN' THEN 1 END) as total_attended, CASE WHEN COUNT(r.id) > 0 THEN ROUND((COUNT(CASE WHEN r.status = 'CHECKED_IN' THEN 1 END)::numeric / COUNT(r.id)::numeric) * 100, 2) ELSE 0 END as attendance_percentage FROM events e LEFT JOIN registrations r ON e.id = r.event_id WHERE e.id = $1 GROUP BY e.id"
    },
    "globalSummary": {
      "sql": "SELECT e.id, e.title, e.status, e.date, (SELECT COALESCE(SUM(amount), 0) FROM incomes WHERE event_id = e.id) as total_income, (SELECT COALESCE(SUM(amount), 0) FROM expenses WHERE event_id = e.id) as total_expenses, (SELECT COALESCE(SUM(agreed_cost), 0) FROM staffing WHERE event_id = e.id) as staff_cost, ((SELECT COALESCE(SUM(amount), 0) FROM incomes WHERE event_id = e.id) - (SELECT COALESCE(SUM(amount), 0) FROM expenses WHERE event_id = e.id) - (SELECT COALESCE(SUM(agreed_cost), 0) FROM staffing WHERE event_id = e.id)) as balance, (SELECT COUNT(*) FROM registrations WHERE event_id = e.id) as total_registered, (SELECT COUNT(*) FROM registrations WHERE event_id = e.id AND status = 'CHECKED_IN') as total_attended FROM events e ORDER BY e.date DESC"
    }
  }
}