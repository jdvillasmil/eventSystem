{
  "security": {
    "loadMethods": {
      "sql": "SELECT\n  pmp.profile_id AS \"profileId\",\n  INITCAP(m.resource) AS \"objectName\",\n  m.action AS \"methodName\"\nFROM public.profile_method_permissions pmp\nJOIN public.methods m ON m.id = pmp.method_id\nWHERE pmp.allowed = TRUE"
    }
  },
  "public": {
    "getUserByUsername": {
      "sql": "SELECT id, username, password_hash AS \"passwordHash\", profile_id AS \"profileId\"\nFROM public.users\nWHERE username = $1"
    },
    "createUser": {
      "sql": "INSERT INTO public.users (username, password_hash, profile_id)\nVALUES ($1, $2, $3)\nRETURNING id"
    },
    "getUserById": {
      "sql": "SELECT id, username, profile_id AS \"profileId\"\nFROM public.users\nWHERE id = $1"
    }
  },
  "Events": {
    "list": {
      "sql": "SELECT * FROM events ORDER BY date ASC"
    },
    "get": {
      "sql": "SELECT * FROM events WHERE id = $1"
    },
    "create": {
      "sql": "INSERT INTO events (title, description, date, location_id, capacity, created_by) VALUES ($1, $2, $3, $4, $5, $6) RETURNING *"
    },
    "update": {
      "sql": "UPDATE events SET title=$2, description=$3, date=$4, location_id=$5, capacity=$6 WHERE id=$1 RETURNING *"
    },
    "delete": {
      "sql": "DELETE FROM events WHERE id=$1"
    }
  },
  "Registrations": {
    "register": {
      "sql": "INSERT INTO registrations (event_id, user_id, guest_name, guest_email) VALUES ($1, $2, $3, $4) RETURNING *"
    },
    "listAttendees": {
      "sql": "SELECT * FROM registrations WHERE event_id = $1"
    },
    "checkIn": {
      "sql": "UPDATE registrations SET status='CHECKED_IN' WHERE id=$1 RETURNING *"
    },
    "cancel": {
      "sql": "UPDATE registrations SET status='CANCELLED' WHERE id=$1 RETURNING *"
    }
  },
  "Reservations": {
    "list": {
      "sql": "SELECT r.*, l.name as location_name, e.title as event_title FROM reservations r JOIN locations l ON r.location_id = l.id LEFT JOIN events e ON r.event_id = e.id ORDER BY r.date ASC"
    },
    "create": {
      "sql": "INSERT INTO reservations (location_id, event_id, date) VALUES ($1, $2, $3) RETURNING *"
    },
    "cancel": {
      "sql": "UPDATE reservations SET status='CANCELLED' WHERE id=$1 RETURNING *"
    },
    "getLocations": {
      "sql": "SELECT * FROM locations ORDER BY name"
    }
  },
  "Roles": {
    "list": {
      "sql": "SELECT * FROM roles ORDER BY name"
    },
    "get": {
      "sql": "SELECT * FROM roles WHERE id = $1"
    }
  },
  "Staffing": {
    "listByEvent": {
      "sql": "SELECT s.*, r.name as role_name FROM staffing s JOIN roles r ON s.role_id = r.id WHERE s.event_id = $1 ORDER BY s.person_name"
    },
    "assign": {
      "sql": "INSERT INTO staffing (event_id, person_name, role_id, agreed_cost) VALUES ($1, $2, $3, $4) RETURNING *"
    },
    "remove": {
      "sql": "DELETE FROM staffing WHERE id = $1"
    }
  },
  "Payments": {
    "listByEvent": {
      "sql": "SELECT s.id as staffing_id, s.person_name, r.name as role_name, s.agreed_cost, p.id as payment_id, p.amount, p.status, p.payment_date FROM staffing s JOIN roles r ON s.role_id = r.id LEFT JOIN payments p ON s.id = p.staffing_id WHERE s.event_id = $1 ORDER BY s.person_name"
    },
    "create": {
      "sql": "INSERT INTO payments (staffing_id, amount, status) VALUES ($1, $2, 'PENDING') RETURNING *"
    },
    "pay": {
      "sql": "UPDATE payments SET status = 'PAID', payment_date = NOW() WHERE id = $1 RETURNING *"
    }
  },
  "Reports": {
    "eventSummary": {
      "sql": "SELECT e.title, e.status, COUNT(DISTINCT r.id) as attendees, COUNT(DISTINCT s.id) as staff_count, COALESCE(SUM(p.amount), 0) as total_payments FROM events e LEFT JOIN registrations r ON e.id = r.event_id LEFT JOIN staffing s ON e.id = s.event_id LEFT JOIN payments p ON s.id = p.staffing_id AND p.status = 'PAID' WHERE e.id = $1 GROUP BY e.id"
    },
    "financialReport": {
      "sql": "SELECT e.title, COALESCE(SUM(s.agreed_cost), 0) as projected_cost, COALESCE(SUM(p.amount), 0) as paid_amount FROM events e LEFT JOIN staffing s ON e.id = s.event_id LEFT JOIN payments p ON s.id = p.staffing_id AND p.status = 'PAID' GROUP BY e.id, e.title"
    },
    "eventFinancialDetail": {
      "sql": "SELECT e.title, e.status, COALESCE(SUM(DISTINCT i.amount), 0) as total_income, COALESCE(SUM(DISTINCT ex.amount), 0) as total_expenses, COALESCE(SUM(DISTINCT s.agreed_cost), 0) as staff_cost, COALESCE(SUM(DISTINCT p.amount), 0) as staff_paid, (COALESCE(SUM(DISTINCT i.amount), 0) - COALESCE(SUM(DISTINCT ex.amount), 0) - COALESCE(SUM(DISTINCT s.agreed_cost), 0)) as balance FROM events e LEFT JOIN incomes i ON e.id = i.event_id LEFT JOIN expenses ex ON e.id = ex.event_id LEFT JOIN staffing s ON e.id = s.event_id LEFT JOIN payments p ON s.id = p.staffing_id AND p.status = 'PAID' WHERE e.id = $1 GROUP BY e.id"
    },
    "eventAttendanceDetail": {
      "sql": "SELECT e.title, COUNT(r.id) as total_registered, COUNT(CASE WHEN r.status = 'CHECKED_IN' THEN 1 END) as total_attended, CASE WHEN COUNT(r.id) > 0 THEN ROUND((COUNT(CASE WHEN r.status = 'CHECKED_IN' THEN 1 END)::numeric / COUNT(r.id)::numeric) * 100, 2) ELSE 0 END as attendance_percentage FROM events e LEFT JOIN registrations r ON e.id = r.event_id WHERE e.id = $1 GROUP BY e.id"
    },
    "globalSummary": {
      "sql": "SELECT e.id, e.title, e.status, e.date, COALESCE(SUM(DISTINCT i.amount), 0) as total_income, COALESCE(SUM(DISTINCT ex.amount), 0) as total_expenses, COALESCE(SUM(DISTINCT s.agreed_cost), 0) as staff_cost, (COALESCE(SUM(DISTINCT i.amount), 0) - COALESCE(SUM(DISTINCT ex.amount), 0) - COALESCE(SUM(DISTINCT s.agreed_cost), 0)) as balance, COUNT(DISTINCT r.id) as total_registered, COUNT(DISTINCT CASE WHEN r.status = 'CHECKED_IN' THEN r.id END) as total_attended FROM events e LEFT JOIN incomes i ON e.id = i.event_id LEFT JOIN expenses ex ON e.id = ex.event_id LEFT JOIN staffing s ON e.id = s.event_id LEFT JOIN registrations r ON e.id = r.event_id GROUP BY e.id ORDER BY e.date DESC"
    }
  }
}